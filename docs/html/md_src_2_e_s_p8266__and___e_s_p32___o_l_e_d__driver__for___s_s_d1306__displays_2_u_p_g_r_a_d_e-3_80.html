<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Farm-Data-Relay-System: Upgrade from 2.0 to 3.0</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Farm-Data-Relay-System
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Upgrade from 2.0 to 3.0</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md33"></a> While developing version 3.0 we made some breaking changes to the public API of this library. This document will help you update your code to work with version 3.0</p>
<h1><a class="anchor" id="autotoc_md34"></a>
Font Definitions</h1>
<p>To get better performance and a smaller font definition format, we change the memory layout of the font definition format. If you are using custom fonts not included in this library we updated the font generator <a href="http://oleddisplay.squix.ch/#/home">here</a>. Please update your fonts to be working with 3.0 by selecting the respective version in the dropdown.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Architectural Changes</h1>
<p>To become a more versatile library for the SSD1306 chipset we abstracted the hardware connection into subclasses of the base display class now called <code>OLEDDisplay</code>. This library is currently shipping with three implementations:</p>
<ul>
<li><code><a class="el" href="class_s_s_d1306_wire.html">SSD1306Wire</a></code> implementing the I2C protocol using the Wire Library. <br  />
</li>
<li><code><a class="el" href="class_s_s_d1306_brzo.html">SSD1306Brzo</a></code> implementing the I2C protocol using the faster <a href="https://github.com/pasko-zh/brzo_i2c"><code>brzo_i2c</code></a> library.</li>
<li><code><a class="el" href="class_s_s_d1306_spi.html">SSD1306Spi</a></code> implementing the SPI protocol.</li>
</ul>
<p>To keep backwards compatiblity with the old API <code>SSD1306</code> is an alias of <code><a class="el" href="class_s_s_d1306_wire.html">SSD1306Wire</a></code>. If you are not using the UI components you don't have to change anything to keep your code working.</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Name Changes</h1>
<p><a href="http://martinfowler.com/bliki/TwoHardThings.html">Naming things is hard</a>, to better reflect our intention with this library we changed the name of the base class to <code>OLEDDisplay</code> and the UI library accordingly to <code><a class="el" href="class_o_l_e_d_display_ui.html">OLEDDisplayUi</a></code>. As a consequence the type definitions of all frame and overlay related functions changed. This means that you have to update all your frame drawing callbacks from:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> frame1(<a class="code hl_class" href="class_s_s_d1306_wire.html">SSD1306</a> *<a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>,  SSD1306UiState* state, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y);</div>
<div class="ttc" id="a_o_l_e_d_display_8h_html_a843628a7aa0280bb966fd8950aab55a1"><div class="ttname"><a href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a></div><div class="ttdeci">virtual void display(void)=0</div></div>
<div class="ttc" id="aclass_s_s_d1306_wire_html"><div class="ttname"><a href="class_s_s_d1306_wire.html">SSD1306Wire</a></div><div class="ttdef"><b>Definition</b> SSD1306Wire.h:44</div></div>
</div><!-- fragment --><p>too</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> frame1(OLEDDisplay *<a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>,  <a class="code hl_struct" href="struct_o_l_e_d_display_ui_state.html">OLEDDisplayUiState</a>* state, int16_t x, int16_t y);</div>
<div class="ttc" id="astruct_o_l_e_d_display_ui_state_html"><div class="ttname"><a href="struct_o_l_e_d_display_ui_state.html">OLEDDisplayUiState</a></div><div class="ttdef"><b>Definition</b> OLEDDisplayUi.h:86</div></div>
</div><!-- fragment --><p>And your overlay drawing functions from:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> overlay1(<a class="code hl_class" href="class_s_s_d1306_wire.html">SSD1306</a> *<a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>,  SSD1306UiState* state);</div>
</div><!-- fragment --><p>too</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> overlay1(OLEDDisplay *<a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>,  <a class="code hl_struct" href="struct_o_l_e_d_display_ui_state.html">OLEDDisplayUiState</a>* state);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37"></a>
New Features</h1>
<h2><a class="anchor" id="autotoc_md38"></a>
Loading Animation</h2>
<p>While using this library ourself we noticed a pattern emerging. We want to drawing a loading progress while connecting to WiFi and updating weather data etc.</p>
<p>The simplest thing was to add the function <code>drawProgressBar(x, y, width,  height, progress)</code> ,where <code>progress</code> is between <code>0</code> and <code>100</code>, right to the <code>OLEDDisplay</code> class.</p>
<p>But we didn't stop there. We added a new feature to the <code><a class="el" href="class_o_l_e_d_display_ui.html">OLEDDisplayUi</a></code> called <code>LoadingStages</code>. You can define your loading process like this:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><a class="code hl_struct" href="struct_loading_stage.html">LoadingStage</a> loadingStages[] = {</div>
<div class="line">  {</div>
<div class="line">    .<a class="code hl_variable" href="struct_loading_stage.html#a501d834686186e717bf63ae76b789212">process</a> = <span class="stringliteral">&quot;Connect to WiFi&quot;</span>,</div>
<div class="line">    .callback = []() {</div>
<div class="line">      <span class="comment">// Connect to WiFi</span></div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  {</div>
<div class="line">    .process = <span class="stringliteral">&quot;Get time from NTP&quot;</span>,</div>
<div class="line">    .callback = []() {</div>
<div class="line">      <span class="comment">// Get current time via NTP</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// more steps</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> LOADING_STAGES_COUNT = <span class="keyword">sizeof</span>(loadingStages) / <span class="keyword">sizeof</span>(<a class="code hl_struct" href="struct_loading_stage.html">LoadingStage</a>);</div>
<div class="ttc" id="astruct_loading_stage_html"><div class="ttname"><a href="struct_loading_stage.html">LoadingStage</a></div><div class="ttdef"><b>Definition</b> OLEDDisplayUi.h:104</div></div>
<div class="ttc" id="astruct_loading_stage_html_a501d834686186e717bf63ae76b789212"><div class="ttname"><a href="struct_loading_stage.html#a501d834686186e717bf63ae76b789212">LoadingStage::process</a></div><div class="ttdeci">const char * process</div><div class="ttdef"><b>Definition</b> OLEDDisplayUi.h:105</div></div>
</div><!-- fragment --><p>After defining your array of <code>LoadingStages</code> you can then run the loading process by using <code>ui.runLoadingProcess(loadingStages, LOADING_STAGES_COUNT)</code>. This will give you a nice little loading animation you can see in the beginning of <a href="https://vimeo.com/168362918">this</a> video.</p>
<p>To further customize this you are free to define your own <code>LoadingDrawFunction</code> like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> myLoadingDraw(OLEDDisplay *<a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>, <a class="code hl_struct" href="struct_loading_stage.html">LoadingStage</a>* stage, uint8_t progress) {</div>
<div class="line">  <a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>-&gt;setTextAlignment(<a class="code hl_enumvalue" href="_o_l_e_d_display_8h.html#a5763ddde39a1e43963c21f2780c21e5aa4da3c85cde615e7442df8ef17d0753ba">TEXT_ALIGN_CENTER</a>);</div>
<div class="line">  <a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>-&gt;setFont(ArialMT_Plain_10);</div>
<div class="line">  <span class="comment">// stage-&gt;process contains the text of the current progress e.q. &quot;Connect to WiFi&quot;</span></div>
<div class="line">  <a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>-&gt;drawString(64, 18, stage-&gt;<a class="code hl_variable" href="struct_loading_stage.html#a501d834686186e717bf63ae76b789212">process</a>);</div>
<div class="line">  <span class="comment">// you could just print the current process without the progress bar</span></div>
<div class="line">  <a class="code hl_function" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display</a>-&gt;drawString(64, 28, progress);</div>
<div class="line">}</div>
<div class="ttc" id="a_o_l_e_d_display_8h_html_a5763ddde39a1e43963c21f2780c21e5aa4da3c85cde615e7442df8ef17d0753ba"><div class="ttname"><a href="_o_l_e_d_display_8h.html#a5763ddde39a1e43963c21f2780c21e5aa4da3c85cde615e7442df8ef17d0753ba">TEXT_ALIGN_CENTER</a></div><div class="ttdeci">@ TEXT_ALIGN_CENTER</div><div class="ttdef"><b>Definition</b> OLEDDisplay.h:133</div></div>
</div><!-- fragment --><p>After defining a function like that, you can pass it to the Ui library by use <code>ui.setLoadingDrawFunction(myLoadingDraw)</code>.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Text Logging</h2>
<p>It is always useful to display some text on the display without worrying to much where it goes and managing it. In 3.0 we made the <code>OLEDDisplay</code> class implement <a href="https://github.com/arduino/Arduino/blob/master/hardware/arduino/avr/cores/arduino/Print.h"><code>Print</code></a> so you can use it like you would use <code>Serial</code>. We calls this feature <code>LogBuffer</code> and the only thing you have to do is to define how many lines you want to display and how many characters there are on average on each. This is done by calling <code>setLogBuffer(lines, chars);</code>. If there is not enough memory the function will return false.</p>
<p>After that you can draw the <code>LogBuffer</code> anywhere you want by calling <code>drawLogBuffer(x, y)</code>. (Note: You have to call <code><a class="el" href="_o_l_e_d_display_8h.html#a843628a7aa0280bb966fd8950aab55a1">display()</a></code> to update the screen) We made a <a href="https://www.youtube.com/watch?v=8Fiss77A3TE">video</a> showing this feature in action. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
