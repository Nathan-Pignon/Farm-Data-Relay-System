\doxysection{fdrs\+\_\+lora.\+h}
\hypertarget{fdrs__lora_8h_source}{}\label{fdrs__lora_8h_source}\index{src/fdrs\_lora.h@{src/fdrs\_lora.h}}
\mbox{\hyperlink{fdrs__lora_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <RadioLib.h>}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Internal\ Globals}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ Default\ values:\ overridden\ by\ settings\ in\ config,\ if\ present}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ GLOBAL\_ACK\_TIMEOUT\ 400\ }\textcolor{comment}{//\ LoRa\ ACK\ timeout\ in\ ms.\ (Minimum\ =\ 200)}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ GLOBAL\_LORA\_RETRIES\ 2\ \ }\textcolor{comment}{//\ LoRa\ ACK\ automatic\ retries\ [0\ -\/\ 3]}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ GLOBAL\_LORA\_TXPWR\ 17\ \ \ }\textcolor{comment}{//\ LoRa\ TX\ power\ in\ dBm\ (:\ +2dBm\ -\/\ +17dBm\ (for\ SX1276-\/7)\ +20dBm\ (for\ SX1278))}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ TXDELAYMS\ 300}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#define\ SPBUFFSIZE\ 10}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#define\ LORASIZE\ (250\ /\ sizeof(DataReading))}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#define\ DRBUFFSIZE\ 100}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ ISBUFFEMPTY(buff)\ ((buff.endIdx\ ==\ buff.startIdx)\ ?\ true:\ false)}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ ISBUFFFULL(buff)\ (((buff.endIdx\ +\ 1)\ \%\ buff.size)\ ==\ buff.startIdx\ ?\ true:\ false)}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ BUFFINCSTART(buff)\ (buff.startIdx\ =\ (buff.startIdx\ +\ 1)\ \%\ buff.size)}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ BUFFINCEND(buff)\ (buff.endIdx\ =\ (buff.endIdx\ +\ 1)\ \%\ buff.size)}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#define\ BUFFCLEAR(buff)\ (buff.startIdx\ =\ buff.endIdx)}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{//\ select\ LoRa\ band\ configuration}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#if\ defined(LORA\_FREQUENCY)}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_FREQUENCY\ LORA\_FREQUENCY}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_FREQUENCY\ GLOBAL\_LORA\_FREQUENCY}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_FREQUENCY}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{comment}{//\ select\ LoRa\ SF\ configuration}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#if\ defined(LORA\_SF)}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_SF\ LORA\_SF}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_SF\ GLOBAL\_LORA\_SF}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_SF}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{comment}{//\ select\ LoRa\ ACK\ configuration}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#if\ defined(LORA\_ACK)\ ||\ defined(GLOBAL\_LORA\_ACK)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_ACK}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_ACK}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{comment}{//\ select\ LoRa\ ACK\ Timeout\ configuration}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#if\ defined(LORA\_ACK\_TIMEOUT)}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#define\ FDRS\_ACK\_TIMEOUT\ LORA\_ACK\_TIMEOUT}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#define\ FDRS\_ACK\_TIMEOUT\ GLOBAL\_ACK\_TIMEOUT}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_ACK\_TIMEOUT}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{//\ select\ LoRa\ Retry\ configuration}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#if\ defined(LORA\_RETRIES)}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_RETRIES\ LORA\_RETRIES}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_RETRIES\ GLOBAL\_LORA\_RETRIES}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_RETRIES}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{comment}{//\ select\ \ LoRa\ Tx\ Power\ configuration}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#if\ defined(LORA\_TXPWR)}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_TXPWR\ LORA\_TXPWR}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_TXPWR\ GLOBAL\_LORA\_TXPWR}}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_TXPWR}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{comment}{//\ select\ \ LoRa\ BANDWIDTH\ configuration}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#if\ defined(LORA\_BANDWIDTH)}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_BANDWIDTH\ LORA\_BANDWIDTH}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_BANDWIDTH\ GLOBAL\_LORA\_BANDWIDTH}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_BANDWIDTH}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{//\ select\ \ LoRa\ Coding\ Rate\ configuration}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#if\ defined(LORA\_CR)}}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_CR\ LORA\_CR}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_CR\ GLOBAL\_LORA\_CR}}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_CR}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{comment}{//\ select\ \ LoRa\ SyncWord\ configuration}}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#if\ defined(LORA\_SYNCWORD)}}
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_SYNCWORD\ LORA\_SYNCWORD}}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_SYNCWORD\ GLOBAL\_LORA\_SYNCWORD}}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_SYNCWORD}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{comment}{//\ select\ \ LoRa\ Release\ Interval\ configuration}}
\DoxyCodeLine{00083\ \textcolor{preprocessor}{\#if\ defined(LORA\_INTERVAL)}}
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_INTERVAL\ LORA\_INTERVAL}}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#define\ FDRS\_LORA\_INTERVAL\ GLOBAL\_LORA\_INTERVAL}}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_INTERVAL}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\#ifndef\ LORA\_BUSY}}
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#define\ LORA\_BUSY\ RADIOLIB\_NC}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#ifdef\ CUSTOM\_SPI}}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#ifdef\ ARDUINO\_ARCH\_RP2040}}
\DoxyCodeLine{00095\ RADIOLIB\_MODULE\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}\ =\ \textcolor{keyword}{new}\ Module(LORA\_SS,\ LORA\_DIO,\ LORA\_RST,\ \mbox{\hyperlink{fdrs__lora_8h_a78ae43f69a4405c4c3f1927930c8bf3e}{LORA\_BUSY}},\ SPI1);}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ RP2040}}
\DoxyCodeLine{00097\ RADIOLIB\_MODULE\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}\ =\ \textcolor{keyword}{new}\ Module(LORA\_SS,\ LORA\_DIO,\ LORA\_RST,\ \mbox{\hyperlink{fdrs__lora_8h_a78ae43f69a4405c4c3f1927930c8bf3e}{LORA\_BUSY}},\ SPI);}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00099\ RADIOLIB\_MODULE\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}\ =\ \textcolor{keyword}{new}\ Module(LORA\_SS,\ LORA\_DIO,\ LORA\_RST,\ \mbox{\hyperlink{fdrs__lora_8h_a78ae43f69a4405c4c3f1927930c8bf3e}{LORA\_BUSY}});}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ CUSTOM\_SPI}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#ifdef\ FDRS\_LORA\_ACK}}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_aee9399e0ee90a2982d7de00ac826f097}{ack}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_aee9399e0ee90a2982d7de00ac826f097}{ack}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ LORA\_ACK}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \mbox{\hyperlink{struct_ping}{Ping}}\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \mbox{\hyperlink{struct_d_r_ring_buffer}{DRRingBuffer}}\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}\ =\ \{.\mbox{\hyperlink{struct_d_r_ring_buffer_a4e75477f21f18498f8f3d8ff55eb43ea}{dr}}\ =\ (\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}*)calloc(\mbox{\hyperlink{fdrs__lora_8h_a2998b6458318bdacc096e5456f256711}{DRBUFFSIZE}},\textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}})),\ \(\backslash\)}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .address\ =\ (uint16\_t*)calloc(\mbox{\hyperlink{fdrs__lora_8h_a2998b6458318bdacc096e5456f256711}{DRBUFFSIZE}},\textcolor{keyword}{sizeof}(uint16\_t)),\ .startIdx\ =\ 0,\ .endIdx\ =\ 0,\ .size\ =\ \mbox{\hyperlink{fdrs__lora_8h_a2998b6458318bdacc096e5456f256711}{DRBUFFSIZE}}\};}
\DoxyCodeLine{00112\ \mbox{\hyperlink{struct_s_p_ring_buffer}{SPRingBuffer}}\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}\ =\ \{.\mbox{\hyperlink{struct_s_p_ring_buffer_aed49a3c8d8b07f8fde3420483c5b0a57}{sp}}\ =\ (\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}*)calloc(\mbox{\hyperlink{fdrs__lora_8h_a3cef938fb755d77891188e33ff5cabce}{SPBUFFSIZE}},\textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}})),\ \(\backslash\)}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .address\ =\ (uint16\_t*)calloc(\mbox{\hyperlink{fdrs__lora_8h_a3cef938fb755d77891188e33ff5cabce}{SPBUFFSIZE}},\textcolor{keyword}{sizeof}(uint16\_t)),\ .startIdx\ =\ 0,\ .endIdx\ =\ 0,\ .size\ =\ \mbox{\hyperlink{fdrs__lora_8h_a3cef938fb755d77891188e33ff5cabce}{SPBUFFSIZE}}\};}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00116\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#ifdef\ FDRS\_GATEWAY}}
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\ \ \ \ \#ifndef\ USE\_ESPNOW\ \ \ }\textcolor{comment}{//\ mac\_prefix\ used\ for\ both\ ESP-\/NOW\ and\ LoRa\ -\/\ avoid\ redefinition\ warnings}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_ae05be0ffbd5af2f1983c5d4bdbdc34ea}{mac\_prefix}}[]\ =\ \{\mbox{\hyperlink{fdrs__globals_8h_a1c8c5652d0d3f46c81014158b9a58cb5}{MAC\_PREFIX}}\};}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[]\ =\ \{\mbox{\hyperlink{fdrs__globals_8h_a1c8c5652d0d3f46c81014158b9a58cb5}{MAC\_PREFIX}},\ UNIT\_MAC\};}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00124\ \ \ \ \ uint16\_t\ LoRa1\ =\ ((\mbox{\hyperlink{fdrs__gateway__espnow_8h_ae05be0ffbd5af2f1983c5d4bdbdc34ea}{mac\_prefix}}[4]\ <<\ 8)\ |\ LORA\_NEIGHBOR\_1);\ \textcolor{comment}{//\ Use\ 2\ bytes\ for\ LoRa\ addressing\ instead\ of\ previous\ 3\ bytes}}
\DoxyCodeLine{00125\ \ \ \ \ uint16\_t\ LoRa2\ =\ ((\mbox{\hyperlink{fdrs__gateway__espnow_8h_ae05be0ffbd5af2f1983c5d4bdbdc34ea}{mac\_prefix}}[4]\ <<\ 8)\ |\ LORA\_NEIGHBOR\_2);}
\DoxyCodeLine{00126\ \ \ \ \ uint16\_t\ loraBroadcast\ =\ 0xFFFF;}
\DoxyCodeLine{00127\ \ \ \ \ uint16\_t\ gtwyAddress\ =\ ((\mbox{\hyperlink{fdrs__gateway__espnow_8h_ae05be0ffbd5af2f1983c5d4bdbdc34ea}{mac\_prefix}}[4]\ <<\ 8)\ |\ UNIT\_MAC);\ \textcolor{comment}{//\ for\ a\ gateway\ this\ is\ our\ own\ address}}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\#elif\ defined(FDRS\_NODE)}}
\DoxyCodeLine{00129\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[6]\ =\ \{0\};}
\DoxyCodeLine{00130\ \ \ \ \ uint16\_t\ LoRa1\ =\ 0;}
\DoxyCodeLine{00131\ \ \ \ \ uint16\_t\ LoRa2\ =\ 0;}
\DoxyCodeLine{00132\ \ \ \ \ uint16\_t\ loraBroadcast\ =\ 0;}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_ae05be0ffbd5af2f1983c5d4bdbdc34ea}{mac\_prefix}}[]\ =\ \{\mbox{\hyperlink{fdrs__globals_8h_a1c8c5652d0d3f46c81014158b9a58cb5}{MAC\_PREFIX}}\};}
\DoxyCodeLine{00134\ \ \ \ \ uint16\_t\ gtwyAddress\ =\ ((\mbox{\hyperlink{fdrs__gateway__espnow_8h_ae05be0ffbd5af2f1983c5d4bdbdc34ea}{mac\_prefix}}[4]\ <<\ 8)\ |\ GTWY\_MAC);\ \ \ \textcolor{comment}{//\ for\ a\ node,\ this\ is\ our\ gateway}}
\DoxyCodeLine{00135\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FDRS\_GATEWAY}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_a09fc5ccb165c85a893083f66bcf6707e}{transmitFlag}}\ =\ \textcolor{keyword}{false};\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ flag\ to\ indicate\ transmission\ or\ reception\ state}}
\DoxyCodeLine{00138\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_af78d7af059e439bcd8015ed07513499b}{enableFDRSInterrupt}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ disable\ interrupt\ when\ it's\ not\ needed}}
\DoxyCodeLine{00139\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_a53896c79caaa5baeab6a96ab3365dcaf}{operationDone}}\ =\ \textcolor{keyword}{false};\ \ \textcolor{comment}{//\ flag\ to\ indicate\ that\ a\ packet\ was\ sent\ or\ received}}
\DoxyCodeLine{00140\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_a69a087bfc34b62d53dbba9720f0bad87}{loraAckTimeout}}\ =\ 0;}
\DoxyCodeLine{00141\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_a95837beac679b370b386022cd310d1b7}{rxCountDR}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ total\ LoRa\ DR\ packets\ destined\ for\ us\ and\ of\ valid\ size}}
\DoxyCodeLine{00142\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_abd895bcd719e719cbbe6b8427e7b4eae}{rxCountSP}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ total\ LoRa\ SP\ packets\ destined\ for\ us\ and\ of\ valid\ size}}
\DoxyCodeLine{00143\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_ae9f7e5dca7e70b1946e0f125f72f5126}{rxCountCrcOk}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ total\ Lora\ packets\ with\ valid\ CRC}}
\DoxyCodeLine{00144\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_af1ff085b3dd4a61d04fd806ad43dbfa9}{txCountDR}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ total\ LoRa\ DR\ packets\ transmitted}}
\DoxyCodeLine{00145\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_a2d5be132cf96e263372a18dbac40389a}{txCountSP}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ total\ LoRa\ SP\ packets\ transmitted}}
\DoxyCodeLine{00146\ \textcolor{keyword}{extern}\ time\_t\ \mbox{\hyperlink{fdrs__lora_8h_a3c3ca8cc859a31aec6578f0dcf1b32a5}{now}};}
\DoxyCodeLine{00147\ time\_t\ \mbox{\hyperlink{fdrs__lora_8h_a48b52f719835d08f27b20cad3069d5f5}{netTimeOffset}}\ =\ UINT32\_MAX;\ \ \textcolor{comment}{//\ One\ direction\ of\ LoRa\ Ping\ time\ in\ units\ of\ seconds\ (1/2\ full\ ping\ time)}}
\DoxyCodeLine{00148\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{fdrs__lora_8h_ad32e5278380d7510ef27e528d32a3672}{tx\_start\_time}}\ =\ 0;}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \textcolor{preprocessor}{\#if\ defined(ESP8266)\ ||\ defined(ESP32)}}
\DoxyCodeLine{00151\ ICACHE\_RAM\_ATTR}
\DoxyCodeLine{00152\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00153\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a4949bc2533dea211ffee4479c9ea246e}{setFlag}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00154\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ check\ if\ the\ interrupt\ is\ enabled}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{fdrs__lora_8h_af78d7af059e439bcd8015ed07513499b}{enableFDRSInterrupt}})}
\DoxyCodeLine{00157\ \ \ \ \ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00159\ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a53896c79caaa5baeab6a96ab3365dcaf}{operationDone}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ we\ sent\ or\ received\ \ packet,\ set\ the\ flag}}
\DoxyCodeLine{00161\ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \textcolor{comment}{//\ crc16\_update\ used\ by\ both\ LoRa\ and\ filesystem}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{comment}{//\ CRC16\ from\ https://github.com/4-\/20ma/ModbusMaster/blob/3a05ff87677a9bdd8e027d6906dc05ca15ca8ade/src/util/crc16.h\#L71}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00177\ \textcolor{keyword}{static}\ uint16\_t\ crc16\_update(uint16\_t\ crc,\ uint8\_t\ a)}
\DoxyCodeLine{00178\ \{}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ crc\ \string^=\ a;}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 8;\ ++i)}
\DoxyCodeLine{00183\ \ \ \{}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{if}\ (crc\ \&\ 1)}
\DoxyCodeLine{00185\ \ \ \ \ \ \ crc\ =\ (crc\ >>\ 1)\ \string^\ 0xA001;}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ crc\ =\ (crc\ >>\ 1);}
\DoxyCodeLine{00188\ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{return}\ crc;}
\DoxyCodeLine{00191\ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_af6c66e36d41879b7be1b1249c254e66b}{printLoraPacket}}(uint8\_t\ *p,\ \textcolor{keywordtype}{int}\ size)}
\DoxyCodeLine{00194\ \{}
\DoxyCodeLine{00195\ \ \ printf(\textcolor{stringliteral}{"{}Printing\ packet\ of\ size\ \%d."{}},\ size);}
\DoxyCodeLine{00196\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ size;\ i++)}
\DoxyCodeLine{00197\ \ \ \{}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ \%\ 2\ ==\ 0)}
\DoxyCodeLine{00199\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n\%02d:\ "{}},\ i);}
\DoxyCodeLine{00200\ \ \ \ \ printf(\textcolor{stringliteral}{"{}\%02X\ "{}},\ p[i]);}
\DoxyCodeLine{00201\ \ \ \}}
\DoxyCodeLine{00202\ \ \ printf(\textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{00203\ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \textcolor{comment}{//\ Do\ not\ call\ this\ function\ directly,\ instead\ call\ transmitLoRaAsync(...)}}
\DoxyCodeLine{00206\ \textcolor{comment}{//\ Transmits\ Lora\ data\ by\ calling\ RadioLib\ library\ function}}
\DoxyCodeLine{00207\ \textcolor{comment}{//\ Returns\ void\ becuase\ function\ is\ Async\ and\ does\ not\ receive\ any\ data}}
\DoxyCodeLine{00208\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(uint16\_t\ *destMac,\ \mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}\ *packet,\ uint8\_t\ len)}
\DoxyCodeLine{00209\ \{}
\DoxyCodeLine{00210\ \ \ \ \ uint8\_t\ pkt[6\ +\ (len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}))];}
\DoxyCodeLine{00211\ \ \ \ \ uint16\_t\ calcCRC\ =\ 0x0000;}
\DoxyCodeLine{00212\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}};}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{comment}{//\ Building\ packet\ -\/-\/\ address\ portion\ -\/\ first\ 4\ bytes}}
\DoxyCodeLine{00214\ \ \ \ \ pkt[0]\ =\ (*destMac\ >>\ 8);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ high\ byte\ of\ destination\ MAC}}
\DoxyCodeLine{00215\ \ \ \ \ pkt[1]\ =\ (*destMac\ \&\ 0x00FF);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ low\ byte\ of\ destination\ MAC}}
\DoxyCodeLine{00216\ \ \ \ \ pkt[2]\ =\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[4];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ high\ byte\ of\ source\ MAC\ (ourselves)}}
\DoxyCodeLine{00217\ \ \ \ \ pkt[3]\ =\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[5];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ low\ byte\ of\ source\ MAC}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ Building\ packet\ -\/-\/\ data\ portion\ -\/\ 7\ bytes}}
\DoxyCodeLine{00219\ \ \ \ \ memcpy(\&pkt[4],\ packet,\ len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}));\ \textcolor{comment}{//\ copy\ data\ portion\ of\ packet}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ Calculate\ CRC\ of\ address\ and\ data\ portion\ of\ the\ packet}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ Last\ 2\ bytes\ are\ CRC\ so\ do\ not\ include\ them\ in\ the\ calculation\ itself}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (\textcolor{keyword}{sizeof}(pkt)\ -\/\ 2);\ i++)}
\DoxyCodeLine{00223\ \ \ \ \ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}CRC:\ \%02X\ :\ \%d\(\backslash\)n"{},calcCRC,\ i);}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ calcCRC\ =\ crc16\_update(calcCRC,\ pkt[i]);}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{fdrs__lora_8h_aee9399e0ee90a2982d7de00ac826f097}{ack}})\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ calcCRC\ =\ crc16\_update(calcCRC,\ 0xA1);\ \textcolor{comment}{//\ Recalculate\ CRC\ for\ No\ ACK}}
\DoxyCodeLine{00229\ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ pkt[len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}})\ +\ 4]\ =\ (calcCRC\ >>\ 8);\ \textcolor{comment}{//\ Append\ calculated\ CRC\ to\ the\ last\ 2\ bytes\ of\ the\ packet}}
\DoxyCodeLine{00231\ \ \ \ \ pkt[len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}})\ +\ 5]\ =\ (calcCRC\ \&\ 0x00FF);}
\DoxyCodeLine{00232\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Sending\ LoRa\ DR"{}});}
\DoxyCodeLine{00233\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Transmitting\ LoRa\ message\ of\ size\ "{}}\ +\ String(\textcolor{keyword}{sizeof}(pkt))\ +\ \textcolor{stringliteral}{"{}\ bytes\ with\ CRC\ 0x"{}}\ +\ String(calcCRC,\ HEX)\ +\ \textcolor{stringliteral}{"{}\ to\ destination\ 0x"{}}\ +\ String(*destMac,\ HEX));}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ printLoraPacket(pkt,sizeof(pkt));}}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad32e5278380d7510ef27e528d32a3672}{tx\_start\_time}}\ =\ millis();}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordtype}{int}\ state\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.startTransmit(pkt,\ \textcolor{keyword}{sizeof}(pkt));}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a09fc5ccb165c85a893083f66bcf6707e}{transmitFlag}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ !=\ RADIOLIB\_ERR\_NONE)}
\DoxyCodeLine{00239\ \ \ \ \ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Xmit\ failed,\ code\ "{}}\ +\ String(state));}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ ;}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_af1ff085b3dd4a61d04fd806ad43dbfa9}{txCountDR}}++;}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00246\ \}}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \textcolor{comment}{//\ For\ now\ SystemPackets\ will\ not\ use\ ACK\ but\ will\ calculate\ CRC}}
\DoxyCodeLine{00249\ \textcolor{comment}{//\ Returns\ CRC\_NULL\ as\ SystemPackets\ do\ not\ use\ ACKS\ at\ current\ time}}
\DoxyCodeLine{00250\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(uint16\_t\ *destMac,\ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ *packet,\ uint8\_t\ len)}
\DoxyCodeLine{00251\ \{}
\DoxyCodeLine{00252\ \ \ \ \ uint8\_t\ pkt[6\ +\ (len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}))];}
\DoxyCodeLine{00253\ \ \ \ \ uint16\_t\ calcCRC\ =\ 0x0000;}
\DoxyCodeLine{00254\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}};}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{comment}{//\ Building\ packet\ -\/-\/\ address\ portion\ -\/\ first\ 4\ bytes}}
\DoxyCodeLine{00256\ \ \ \ \ pkt[0]\ =\ (*destMac\ >>\ 8);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ high\ byte\ of\ destination\ MAC}}
\DoxyCodeLine{00257\ \ \ \ \ pkt[1]\ =\ (*destMac\ \&\ 0x00FF);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ low\ byte\ of\ destination\ MAC}}
\DoxyCodeLine{00258\ \ \ \ \ pkt[2]\ =\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[4];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ high\ byte\ of\ source\ MAC\ (ourselves)}}
\DoxyCodeLine{00259\ \ \ \ \ pkt[3]\ =\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[5];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ low\ byte\ of\ source\ MAC}}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{comment}{//\ Building\ packet\ -\/-\/\ data\ portion\ -\/\ 5\ bytes}}
\DoxyCodeLine{00261\ \ \ \ \ memcpy(\&pkt[4],\ packet,\ len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}));\ \textcolor{comment}{//\ copy\ data\ portion\ of\ packet}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ Calculate\ CRC\ of\ address\ and\ data\ portion\ of\ the\ packet}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{comment}{//\ Last\ 2\ bytes\ are\ CRC\ so\ do\ not\ include\ them\ in\ the\ calculation\ itself}}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (\textcolor{keyword}{sizeof}(pkt)\ -\/\ 2);\ i++)}
\DoxyCodeLine{00265\ \ \ \ \ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}CRC:\ \%02X\ :\ \%d\(\backslash\)n"{},calcCRC,\ i);}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ calcCRC\ =\ crc16\_update(calcCRC,\ pkt[i]);}
\DoxyCodeLine{00268\ \ \ \ \ \}}
\DoxyCodeLine{00269\ \ \ \ \ calcCRC\ =\ crc16\_update(calcCRC,\ 0xA1);\ \textcolor{comment}{//\ Recalculate\ CRC\ for\ No\ ACK}}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ Building\ packet\ -\/-\/\ adding\ CRC\ -\/\ last\ 2\ bytes}}
\DoxyCodeLine{00271\ \ \ \ \ pkt[len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}})\ +\ 4]\ =\ (calcCRC\ >>\ 8);}
\DoxyCodeLine{00272\ \ \ \ \ pkt[len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}})\ +\ 5]\ =\ (calcCRC\ \&\ 0x00FF);}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{comment}{//\ Packet\ is\ constructed\ now\ transmit\ the\ packet}}
\DoxyCodeLine{00274\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Transmitting\ LoRa\ message\ of\ size\ "{}}\ +\ String(\textcolor{keyword}{sizeof}(pkt))\ +\ \textcolor{stringliteral}{"{}\ bytes\ with\ CRC\ 0x"{}}\ +\ String(calcCRC,\ HEX)\ +\ \textcolor{stringliteral}{"{}\ to\ destination\ 0x"{}}\ +\ String(*destMac,\ HEX));}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{comment}{//\ printLoraPacket(pkt,sizeof(pkt));}}
\DoxyCodeLine{00276\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad32e5278380d7510ef27e528d32a3672}{tx\_start\_time}}\ =\ millis();}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordtype}{int}\ state\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.startTransmit(pkt,\ \textcolor{keyword}{sizeof}(pkt));}
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a09fc5ccb165c85a893083f66bcf6707e}{transmitFlag}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ !=\ RADIOLIB\_ERR\_NONE)}
\DoxyCodeLine{00280\ \ \ \ \ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Xmit\ failed,\ code\ "{}}\ +\ String(state));}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ ;}
\DoxyCodeLine{00284\ \ \ \ \ \}}
\DoxyCodeLine{00285\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a2d5be132cf96e263372a18dbac40389a}{txCountSP}}++;}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00287\ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a891be47f9b62be2d0335d591e4f3fc0e}{begin\_lora}}()}
\DoxyCodeLine{00290\ \{}
\DoxyCodeLine{00291\ \textcolor{preprocessor}{\#ifdef\ CUSTOM\_SPI}}
\DoxyCodeLine{00292\ \textcolor{preprocessor}{\#ifdef\ ESP32}}
\DoxyCodeLine{00293\ \ \ SPI.begin(LORA\_SPI\_SCK,\ LORA\_SPI\_MISO,\ LORA\_SPI\_MOSI);}
\DoxyCodeLine{00294\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ ESP32}}
\DoxyCodeLine{00295\ \textcolor{preprocessor}{\#ifdef\ ARDUINO\_ARCH\_RP2040}}
\DoxyCodeLine{00296\ \ \ SPI1.setRX(LORA\_SPI\_MISO);}
\DoxyCodeLine{00297\ \ \ SPI1.setTX(LORA\_SPI\_MOSI);}
\DoxyCodeLine{00298\ \ \ SPI1.setSCK(LORA\_SPI\_SCK);}
\DoxyCodeLine{00299\ \ \ SPI1.begin(\textcolor{keyword}{false});}
\DoxyCodeLine{00300\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//ARDUINO\_ARCH\_RP2040}}
\DoxyCodeLine{00301\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ CUSTOM\_SPI}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \textcolor{preprocessor}{\#ifdef\ USE\_SX126X}}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordtype}{int}\ state\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.begin(\mbox{\hyperlink{fdrs__lora_8h_a0d8f69fcbd35ccb4d008ba7a483ef847}{FDRS\_LORA\_FREQUENCY}},\ \mbox{\hyperlink{fdrs__lora_8h_a3660e0f9c4e0ed10fecd245c00e92802}{FDRS\_LORA\_BANDWIDTH}},\ \mbox{\hyperlink{fdrs__lora_8h_ab6a9cf593ff68d0fd3690d7bfed9e9a1}{FDRS\_LORA\_SF}},\ \mbox{\hyperlink{fdrs__lora_8h_a62d1019ec7e0c6a2be02eae6c3127f84}{FDRS\_LORA\_CR}},\ \mbox{\hyperlink{fdrs__lora_8h_a66d7815a575deb69cf1576c650f4af19}{FDRS\_LORA\_SYNCWORD}},\ \mbox{\hyperlink{fdrs__lora_8h_aa4f4bd97bffc9506a3d11dbc8ac9fc7e}{FDRS\_LORA\_TXPWR}},\ 8,\ 1.6,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00305\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00306\ \ \ \textcolor{keywordtype}{int}\ state\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.begin(\mbox{\hyperlink{fdrs__lora_8h_a0d8f69fcbd35ccb4d008ba7a483ef847}{FDRS\_LORA\_FREQUENCY}},\ \mbox{\hyperlink{fdrs__lora_8h_a3660e0f9c4e0ed10fecd245c00e92802}{FDRS\_LORA\_BANDWIDTH}},\ \mbox{\hyperlink{fdrs__lora_8h_ab6a9cf593ff68d0fd3690d7bfed9e9a1}{FDRS\_LORA\_SF}},\ \mbox{\hyperlink{fdrs__lora_8h_a62d1019ec7e0c6a2be02eae6c3127f84}{FDRS\_LORA\_CR}},\ \mbox{\hyperlink{fdrs__lora_8h_a66d7815a575deb69cf1576c650f4af19}{FDRS\_LORA\_SYNCWORD}},\ \mbox{\hyperlink{fdrs__lora_8h_aa4f4bd97bffc9506a3d11dbc8ac9fc7e}{FDRS\_LORA\_TXPWR}},\ 8,\ 0);}
\DoxyCodeLine{00307\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ RADIOLIB\_ERR\_NONE)}
\DoxyCodeLine{00310\ \ \ \ \ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}RadioLib\ initialization\ successful!"{}});}
\DoxyCodeLine{00312\ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00314\ \ \ \ \ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}RadioLib\ initialization\ failed,\ code\ "{}}\ +\ String(state));}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ ;}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ \textcolor{preprocessor}{\#ifdef\ USE\_SX126X}}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.setDio1Action(\mbox{\hyperlink{fdrs__lora_8h_a4949bc2533dea211ffee4479c9ea246e}{setFlag}});}
\DoxyCodeLine{00321\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00322\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.setDio0Action(\mbox{\hyperlink{fdrs__lora_8h_a4949bc2533dea211ffee4479c9ea246e}{setFlag}},\ RISING);}
\DoxyCodeLine{00323\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00324\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.setCRC(\textcolor{keyword}{false});}
\DoxyCodeLine{00325\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}LoRa\ Initialized.\ Frequency:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a0d8f69fcbd35ccb4d008ba7a483ef847}{FDRS\_LORA\_FREQUENCY}})\ +\ \textcolor{stringliteral}{"{}\ \ Bandwidth:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a3660e0f9c4e0ed10fecd245c00e92802}{FDRS\_LORA\_BANDWIDTH}})\ +\ \textcolor{stringliteral}{"{}\ \ SF:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_ab6a9cf593ff68d0fd3690d7bfed9e9a1}{FDRS\_LORA\_SF}})\ +\ \textcolor{stringliteral}{"{}\ \ CR:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a62d1019ec7e0c6a2be02eae6c3127f84}{FDRS\_LORA\_CR}})\ +\ \textcolor{stringliteral}{"{}\ \ SyncWord:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a66d7815a575deb69cf1576c650f4af19}{FDRS\_LORA\_SYNCWORD}})\ +\ \textcolor{stringliteral}{"{}\ \ Tx\ Power:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_aa4f4bd97bffc9506a3d11dbc8ac9fc7e}{FDRS\_LORA\_TXPWR}})\ +\ \textcolor{stringliteral}{"{}dBm"{}});}
\DoxyCodeLine{00326\ \textcolor{preprocessor}{\#ifdef\ FDRS\_NODE}}
\DoxyCodeLine{00327\ \ \ \ \ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[4]\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.randomByte();}
\DoxyCodeLine{00328\ \ \ \ \ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[5]\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.randomByte();}
\DoxyCodeLine{00329\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}LoRa\ node\ address\ is\ 0x"{}}\ +\ String(\mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[4],\ HEX)\ +\ String(\mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[5],\ HEX));}
\DoxyCodeLine{00330\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00331\ \ \ \ \ state\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.startReceive();\ \textcolor{comment}{//\ start\ listening\ for\ LoRa\ packets}}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ !=\ RADIOLIB\_ERR\_NONE)}
\DoxyCodeLine{00333\ \ \ \ \ \{}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}\ failed,\ code\ "{}}\ +\ String(state));}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ ;}
\DoxyCodeLine{00337\ \ \ \ \ \}}
\DoxyCodeLine{00338\ \}}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(uint16\_t\ *destAddr,\ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ *sp,\ uint8\_t\ len)}
\DoxyCodeLine{00341\ \{\ \ \ }
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i\ <\ len;\ i++)}
\DoxyCodeLine{00343\ \ \ \ \ \{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \textcolor{comment}{//check\ for\ full\ buffer}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a5574e9ef98c09926b8b80d4ae41f09fd}{ISBUFFFULL}}(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}))\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Lora\ SP\ Buffer\ Overflow!"{}});}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_af43d1a73cc05315ae8de6c47d2874786}{BUFFINCSTART}}(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}});}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00349\ \ \ \ \ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{comment}{//add\ packet\ to\ buffer}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ *(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_aed49a3c8d8b07f8fde3420483c5b0a57}{sp}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_ad81cacbdce05a50f9ee9cb228dce061a}{endIdx}})\ =\ *(sp\ +\ i);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ *(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_abb07d423f8f393794dad992291c7dd1c}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_ad81cacbdce05a50f9ee9cb228dce061a}{endIdx}})\ =\ *destAddr;}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a69f5d57e9c2c80a1dca2f2f035ace2a4}{BUFFINCEND}}(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}});}
\DoxyCodeLine{00354\ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}SP\ added\ to\ LoRa\ buffer.\ start:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}})\ +\ \textcolor{stringliteral}{"{}\ end:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_ad81cacbdce05a50f9ee9cb228dce061a}{endIdx}}));}
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00357\ \}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \textcolor{comment}{//\ Wrapper\ for\ transmitLoRa\ for\ DataReading\ type\ packets\ to\ handle\ processing\ Receiving\ CRCs\ and\ retransmitting\ packets}}
\DoxyCodeLine{00360\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(uint16\_t\ *destAddr,\ \mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}\ *dr,\ uint8\_t\ len)}
\DoxyCodeLine{00361\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{comment}{//\ Write\ as\ much\ as\ needed\ and\ just\ flush\ out\ the\ older\ data\ if\ too\ much\ data\ writing\ to\ buffer}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//add\ packet\ to\ buffer}}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i\ <\ len;\ i++)}
\DoxyCodeLine{00365\ \ \ \ \ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a5574e9ef98c09926b8b80d4ae41f09fd}{ISBUFFFULL}}(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}))}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Lora\ DR\ Buffer\ Overflow!"{}});}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ just\ lost\ one\ reading\ -\/\ the\ oldest\ reading}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_af43d1a73cc05315ae8de6c47d2874786}{BUFFINCSTART}}(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}});}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ *(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a4e75477f21f18498f8f3d8ff55eb43ea}{dr}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a9212c8c7190eda79249e32e0ddcb9548}{endIdx}})\ =\ *(dr\ +\ i);}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ *(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_af385236abc4145b6d4695b41ec98bece}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a9212c8c7190eda79249e32e0ddcb9548}{endIdx}})\ =\ *destAddr;}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a69f5d57e9c2c80a1dca2f2f035ace2a4}{BUFFINCEND}}(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}});}
\DoxyCodeLine{00375\ \ \ \ \ \}}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{comment}{//\ for(int\ i=drBuff.startIdx;\ i!=drBuff.endIdx;\ i\ =\ (i\ +\ 1)\ \%\ drBuff.size)\ \{}}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ printf("{}id:\ \%d,\ type:\ \%d\ data:\ \%f\ address:\ \%X\(\backslash\)n"{},(drBuff.dr\ +\ i)-\/>id,\ (drBuff.dr\ +\ i)-\/>t,\ (drBuff.dr\ +\ i)-\/>d,\ *(drBuff.address\ +\ drBuff.startIdx));}}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00379\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}DR\ added\ to\ LoRa\ buffer.\ start:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}})\ +\ \textcolor{stringliteral}{"{}\ end:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a9212c8c7190eda79249e32e0ddcb9548}{endIdx}}));}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00381\ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \textcolor{comment}{//\ return\ the\ number\ of\ consecutive\ DRs\ in\ the\ DR\ Queue\ that\ have\ the\ same\ destination\ address}}
\DoxyCodeLine{00384\ uint\ \mbox{\hyperlink{fdrs__lora_8h_a966f72b5662abef538f8611d6e50798f}{transmitSameAddrLoRa}}()\ \{}
\DoxyCodeLine{00385\ \ \ \ \ uint\ count\ =\ 0;}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}};\ i!=\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a9212c8c7190eda79249e32e0ddcb9548}{endIdx}};\ i\ =\ (i\ +\ 1)\ \%\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5a652051b9bd955cb4861dbd95bd2267}{size}})\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(*(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_af385236abc4145b6d4695b41ec98bece}{address}}\ +\ i)\ ==\ *(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_af385236abc4145b6d4695b41ec98bece}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}}))}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ count++;}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{comment}{//\ check\ for\ data\ size\ greater\ than\ what\ can\ be\ sent\ via\ LoRa\ packets}}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{keywordflow}{if}(count\ >\ \mbox{\hyperlink{fdrs__lora_8h_a364091ba725ebfafacaf152abe6a6398}{LORASIZE}})\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__lora_8h_a364091ba725ebfafacaf152abe6a6398}{LORASIZE}};}
\DoxyCodeLine{00397\ \ \ \ \ \}}
\DoxyCodeLine{00398\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{00400\ \ \ \ \ \}}
\DoxyCodeLine{00401\ \}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \textcolor{comment}{//\ Send\ time\ to\ LoRa\ broadcast\ and\ peers}}
\DoxyCodeLine{00404\ \textcolor{comment}{//\ Only\ used\ in\ gateways}}
\DoxyCodeLine{00405\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a181e287094b776a5461ee501144b60de}{sendTimeLoRa}}()\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ node\ or\ gateway.\ \ Do\ not\ send\ if\ we\ are\ a\ node.}}
\DoxyCodeLine{00407\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[0]\ !=\ 0)\ \{}
\DoxyCodeLine{00408\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Sending\ time\ via\ LoRa"{}});}
\DoxyCodeLine{00409\ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ spTimeLoRa\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ae8c4c8b96c31a124ba227f864bf69a28}{cmd\_time}},\ .param\ =\ \mbox{\hyperlink{fdrs__lora_8h_a3c3ca8cc859a31aec6578f0dcf1b32a5}{now}}\};}
\DoxyCodeLine{00410\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Sending\ time\ to\ LoRa\ broadcast"{}});}
\DoxyCodeLine{00411\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&loraBroadcast,\ \&spTimeLoRa,\ 1);}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{comment}{//\ Do\ not\ send\ to\ LoRa\ peers\ if\ their\ address\ is\ 0x..00}}
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{if}(((LoRa1\ \&\ 0x00FF)\ !=\ 0x0000)\ \&\&\ (LoRa1\ !=\ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}}))\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Sending\ time\ to\ LoRa\ Neighbor\ 1"{}});}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ spTimeLoRa.param\ =\ \mbox{\hyperlink{fdrs__lora_8h_a3c3ca8cc859a31aec6578f0dcf1b32a5}{now}};}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ LoRa\ neighbor\ 1}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&LoRa1,\ \&spTimeLoRa,\ 1);}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{keywordflow}{if}(((LoRa2\ \&\ 0x00FF)\ !=\ 0x0000)\ \&\&\ (LoRa2\ !=\ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}}))\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Sending\ time\ to\ LoRa\ Neighbor\ 2"{}});}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ spTimeLoRa.param\ =\ \mbox{\hyperlink{fdrs__lora_8h_a3c3ca8cc859a31aec6578f0dcf1b32a5}{now}};}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ LoRa\ neighbor\ 2}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&LoRa2,\ \&spTimeLoRa,\ 1);}
\DoxyCodeLine{00424\ \ \ \ \ \}}
\DoxyCodeLine{00425\ \ \ \}}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00427\ \}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \textcolor{comment}{//\ Send\ time\ to\ LoRa\ node\ at\ specific\ address\ -\/\ gateway}}
\DoxyCodeLine{00430\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a181e287094b776a5461ee501144b60de}{sendTimeLoRa}}(uint16\_t\ addr)\ \{}
\DoxyCodeLine{00431\ \ \ }
\DoxyCodeLine{00432\ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ spTimeLoRa\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ae8c4c8b96c31a124ba227f864bf69a28}{cmd\_time}},\ .param\ =\ \mbox{\hyperlink{fdrs__lora_8h_a3c3ca8cc859a31aec6578f0dcf1b32a5}{now}}\};}
\DoxyCodeLine{00433\ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Sending\ time\ to\ LoRa\ address\ 0x"{}}\ +\ String(addr,HEX));}
\DoxyCodeLine{00434\ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&addr,\ \&spTimeLoRa,\ 1);}
\DoxyCodeLine{00435\ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00436\ \}}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \textcolor{comment}{//\ FDRS\ sends\ ping\ reply\ -\/\ gateway}}
\DoxyCodeLine{00439\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_acc09bae7abef05baefa389035bcc1b9b}{pingReplyLoRa}}(uint16\_t\ address)}
\DoxyCodeLine{00440\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ sys\_packet\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7a4da9c09ff21a0893109b13aad2f7ff54}{cmd\_ping}},\ .param\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_aa4dafeab552538320e86e60510104161a24208d40d11ed471b5e5ad6544cd7d3d}{ping\_reply}}\};}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}})\ \{}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ping\ reply\ sent\ to\ address:\ 0x"{}}\ +\ String(address,\ HEX));}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(\&address,\&sys\_packet,1);}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&address,\ \&sys\_packet,\ 1))}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ping\ reply\ queued\ to\ address:\ 0x"{}}\ +\ String(address,\ HEX));}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Error\ sending\ LoRa\ ping."{}});}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00459\ \}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \textcolor{comment}{//\ ****DO\ NOT\ CALL\ receiveLoRa()\ directly!\ *****\ \ \ Call\ handleLoRa()\ instead!}}
\DoxyCodeLine{00462\ \textcolor{comment}{//\ receiveLoRa\ for\ Sensors}}
\DoxyCodeLine{00463\ \textcolor{comment}{//\ \ USED\ to\ get\ ACKs\ (SystemPacket\ type)\ from\ LoRa\ gateway\ at\ this\ point.\ \ May\ be\ used\ in\ the\ future\ to\ get\ other\ data}}
\DoxyCodeLine{00464\ \textcolor{comment}{//\ Return\ type\ is\ crcResult\ struct\ -\/\ CRC\_OK,\ CRC\_BAD,\ CRC\_NULL.\ \ CRC\_NULL\ used\ for\ non-\/ack\ data}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560}{crcResult}}\ \mbox{\hyperlink{fdrs__lora_8h_abcacf76f32a98451684e7a2ed4a353a5}{receiveLoRa}}()}
\DoxyCodeLine{00467\ \{}
\DoxyCodeLine{00468\ \ \ \ \ \textcolor{keywordtype}{int}\ packetSize\ =\ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.getPacketLength();}
\DoxyCodeLine{00469\ \ \ \ \ \textcolor{keywordflow}{if}\ ((((packetSize\ -\/\ 6)\ \%\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}})\ ==\ 0)\ ||\ ((packetSize\ -\/\ 6)\ \%\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}})\ ==\ 0))\ \&\&\ packetSize\ >\ 0)}
\DoxyCodeLine{00470\ \ \ \ \ \{\ \textcolor{comment}{//\ packet\ size\ should\ be\ 6\ bytes\ plus\ multiple\ of\ size\ of\ DataReading}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ uint8\_t\ packet[packetSize];}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ uint16\_t\ packetCRC\ =\ 0x0000;\ \textcolor{comment}{//\ CRC\ Extracted\ from\ received\ LoRa\ packet}}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ uint16\_t\ calcCRC\ =\ 0x0000;\ \ \ \textcolor{comment}{//\ CRC\ calculated\ from\ received\ LoRa\ packet}}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ uint16\_t\ sourceMAC\ =\ 0x0000;}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ uint16\_t\ destMAC\ =\ 0x0000;}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.readData((uint8\_t\ *)\&packet,\ packetSize);}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ destMAC\ =\ (packet[0]\ <<\ 8)\ |\ packet[1];}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ sourceMAC\ =\ (packet[2]\ <<\ 8)\ |\ packet[3];}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ packetCRC\ =\ ((packet[packetSize\ -\/\ 2]\ <<\ 8)\ |\ packet[packetSize\ -\/\ 1]);}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Print\ all\ packets}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DBG2("{}Source\ Address:\ 0x"{}\ +\ String(packet[2],\ HEX)\ +\ String(packet[3],\ HEX)\ +\ "{}\ Destination\ Address:\ 0x"{}\ +\ String(packet[0],\ HEX)\ +\ String(packet[1],\ HEX));}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00485\ \textcolor{preprocessor}{\#ifdef\ FDRS\_GATEWAY}}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ gateway\ -\/\ only\ listen\ to\ our\ own\ address}}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (destMAC\ ==\ (\mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[4]\ <<\ 8\ |\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[5]))}
\DoxyCodeLine{00488\ \#elif\ defined(\mbox{\hyperlink{fdrs__node_8h_acc3c8a90fdbfd4e6cbfda970046b5037}{FDRS\_NODE}})}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ Node\ -\/\ need\ to\ listen\ to\ broadcast}}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (destMAC\ ==\ (\mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[4]\ <<\ 8\ |\ \mbox{\hyperlink{fdrs__gateway__espnow_8h_a78d61ab3b22fe965f5f3bc4dbc19ca38}{selfAddress}}[5])\ ||\ (destMAC\ ==\ 0xFFFF))}
\DoxyCodeLine{00491\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Check\ if\ addressed\ to\ this\ device\ or\ broadcast}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printLoraPacket(packet,sizeof(packet));}}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Incoming\ LoRa.\ Size:\ "{}}\ +\ String(packetSize)\ +\ \textcolor{stringliteral}{"{}\ Bytes,\ RSSI:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.getRSSI())\ +\ \textcolor{stringliteral}{"{}dBm,\ SNR:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.getSNR())\ +\ \textcolor{stringliteral}{"{}dB,\ PacketCRC:\ 0x"{}}\ +\ String(packetCRC,\ HEX));}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Evaluate\ CRC}}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (packetSize\ -\/\ 2);\ i++)}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Last\ 2\ bytes\ of\ packet\ are\ the\ CRC\ so\ do\ not\ include\ them\ in\ calculation}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printf("{}CRC:\ \%02X\ :\ \%d\(\backslash\)n"{},calcCRC,\ i);}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ calcCRC\ =\ crc16\_update(calcCRC,\ packet[i]);}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((packetSize\ -\/\ 6)\ \%\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}})\ ==\ 0)}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ DataReading\ type\ packet}}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a95837beac679b370b386022cd310d1b7}{rxCountDR}}++;}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (calcCRC\ ==\ packetCRC)}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \textcolor{comment}{//\ We've\ received\ a\ DR\ and\ sending\ an\ ACK\ }}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ ACK\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ac4f03f64adad9507e3d982dbb8f4d265}{cmd\_ack}},\ .param\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ae989d9d773a74fcc7a0efce652f99ece}{CRC\_OK}}\};}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}CRC\ Match,\ sending\ ACK\ packet\ to\ node\ 0x"{}}\ +\ String(sourceMAC,\ HEX)\ +\ \textcolor{stringliteral}{"{}(hex)"{}});}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&sourceMAC,\ \&ACK,\ 1);\ \textcolor{comment}{//\ Send\ ACK\ back\ to\ source}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (packetCRC\ ==\ crc16\_update(calcCRC,\ 0xA1))}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Sender\ does\ not\ want\ ACK\ and\ CRC\ is\ valid}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Node\ address\ 0x"{}}\ +\ String(sourceMAC,\ 16)\ +\ \textcolor{stringliteral}{"{}\ does\ not\ want\ ACK"{}});}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \textcolor{comment}{//\ We've\ received\ a\ DR\ and\ CRC\ is\ bad}}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ NAK\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ac4f03f64adad9507e3d982dbb8f4d265}{cmd\_ack}},\ .param\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560a892b1e404d6fbb471d6476088ad0accf}{CRC\_BAD}}\};}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Send\ NAK\ packet}}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}CRC\ Mismatch!\ Packet\ CRC\ is\ 0x"{}}\ +\ String(packetCRC,\ HEX)\ +\ \textcolor{stringliteral}{"{},\ Calculated\ CRC\ is\ 0x"{}}\ +\ String(calcCRC,\ HEX)\ +\ \textcolor{stringliteral}{"{}\ Sending\ NAK\ packet\ to\ node\ 0x"{}}\ +\ String(sourceMAC,\ HEX)\ +\ \textcolor{stringliteral}{"{}(hex)"{}});}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&sourceMAC,\ \&NAK,\ 1);\ \textcolor{comment}{//\ CRC\ did\ not\ match\ so\ send\ NAK\ to\ source}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a21b4ef48eaa41b25a7933ead71d376c4}{newData}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a06fc87d81c62e9abb8790b6e5713c55ba9698f47448b941c623678667bae750f4}{event\_clear}};\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ not\ process\ data\ as\ data\ may\ be\ corrupt}}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560a892b1e404d6fbb471d6476088ad0accf}{CRC\_BAD}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exit\ function\ and\ do\ not\ update\ newData\ to\ send\ invalid\ data\ further\ on}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ae9f7e5dca7e70b1946e0f125f72f5126}{rxCountCrcOk}}++;}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(\&\mbox{\hyperlink{fdrs__gateway_8h_a718ba593017f95b5e4a74c39d9ad852f}{theData}},\ \&packet[4],\ packetSize\ -\/\ 6);\ \textcolor{comment}{//\ Split\ off\ data\ portion\ of\ packet\ (N\ -\/\ 6\ bytes\ (6\ bytes\ for\ headers\ and\ CRC))}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}\ =\ (packetSize\ -\/\ 6)\ /\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}});}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (memcmp(\&sourceMAC,\ \&LoRa1,\ 2)\ ==\ 0)}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Check\ if\ it\ is\ from\ a\ registered\ sender}}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a21b4ef48eaa41b25a7933ead71d376c4}{newData}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a06fc87d81c62e9abb8790b6e5713c55ba6a3cc8a6e5cc4b111d0b904c42f1a24d}{event\_lora1}};}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ae989d9d773a74fcc7a0efce652f99ece}{CRC\_OK}};}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (memcmp(\&sourceMAC,\ \&LoRa2,\ 2)\ ==\ 0)}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a21b4ef48eaa41b25a7933ead71d376c4}{newData}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a06fc87d81c62e9abb8790b6e5713c55ba759c4bd2a4abaec17269200ec7380608}{event\_lora2}};}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ae989d9d773a74fcc7a0efce652f99ece}{CRC\_OK}};}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a21b4ef48eaa41b25a7933ead71d376c4}{newData}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a06fc87d81c62e9abb8790b6e5713c55ba53a116068a0637d90d9a9b7de864c69f}{event\_lorag}};}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ae989d9d773a74fcc7a0efce652f99ece}{CRC\_OK}};}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((packetSize\ -\/\ 6)\ ==\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}))}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}\ =\ (packetSize\ -\/\ 6)\ /\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}});}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ receiveData[\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}];}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_abd895bcd719e719cbbe6b8427e7b4eae}{rxCountSP}}++;}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((packetCRC\ ==\ calcCRC)\ ||\ (packetCRC\ ==\ crc16\_update(calcCRC,\ 0xA1)))}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(receiveData,\ \&packet[4],\ packetSize\ -\/\ 6);\ \textcolor{comment}{//\ Split\ off\ data\ portion\ of\ packet\ (N\ bytes)}}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}\ ==\ 1\ \&\&\ receiveData[0].cmd\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ac4f03f64adad9507e3d982dbb8f4d265}{cmd\_ack}})}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}ACK\ Received\ -\/\ CRC\ Match"{}});}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}})\ \{}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a13e882d3b2a4c0130d1184048e49cb3f}{stCrcMatch}};}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}\ ==\ 1\ \&\&\ receiveData[0].cmd\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7a4da9c09ff21a0893109b13aad2f7ff54}{cmd\_ping}})}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ We\ have\ received\ a\ ping\ request\ or\ reply??}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (receiveData[0].param\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_aa4dafeab552538320e86e60510104161a24208d40d11ed471b5e5ad6544cd7d3d}{ping\_reply}})}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ This\ is\ a\ reply\ to\ our\ ping\ request}}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aad5e08feb2be4947352bc94a98949d0c}{stCompleted}};}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Ping\ reply\ via\ LoRa\ from\ address\ 0x"{}}\ +\ String(sourceMAC,\ HEX));}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (receiveData[0].param\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_aa4dafeab552538320e86e60510104161ad6362076ada2df50c0c1d659420ec819}{ping\_request}})}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Ping\ request\ from\ 0x"{}}\ +\ String(sourceMAC,\ HEX)\ +\ \textcolor{stringliteral}{"{},\ Replying."{}});}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_acc09bae7abef05baefa389035bcc1b9b}{pingReplyLoRa}}(sourceMAC);}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}\ ==\ 1\ \&\&\ receiveData[0].cmd\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ae8c4c8b96c31a124ba227f864bf69a28}{cmd\_time}}\ \&\&\ receiveData[0].param\ >\ \mbox{\hyperlink{fdrs__time_8h_a0cc72cae6afbbca11ed1c2bef9c727e6}{MIN\_TS}})\ \{\ \textcolor{comment}{//\ Time\ received}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_a94d9f4625ede8aeb5191e8a9463b18bc}{tmNetIf}}\ <=\ \mbox{\hyperlink{fdrs__datatypes_8h_ac11f08c2870e2d2711e6ad57b57b81e0a1b25e81aeb538cf0a393b10ab33435d8}{TMIF\_LORA}})\ \{}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Time\ rcv\ from\ LoRa\ 0x"{}}\ +\ String(sourceMAC,\ HEX));}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_a94d9f4625ede8aeb5191e8a9463b18bc}{tmNetIf}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_ac11f08c2870e2d2711e6ad57b57b81e0a351673831bf6495a31c22aefd7094a15}{TMIF\_NONE}})\ \{}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_a94d9f4625ede8aeb5191e8a9463b18bc}{tmNetIf}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_ac11f08c2870e2d2711e6ad57b57b81e0a1b25e81aeb538cf0a393b10ab33435d8}{TMIF\_LORA}};}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}}\ =\ sourceMAC;}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aade6613821732512338366ebfd320f00}{tmSource}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_af74fa2f072a46f0f62317e415a6d3d2cae0186f84dd17aeeffa5dbd15b28173ce}{TMS\_NET}};}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Time\ source\ is\ LoRa\ 0x"{}}\ +\ String(sourceMAC,\ HEX));}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}}\ ==\ sourceMAC)\ \{}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__time_8h_af35daa77797bfa09ee892fbeef694e2d}{setTime}}(receiveData[0].param))\ \{}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aaa6414b912b7ed0d9f66f52acf28acc7}{tmLastTimeSet}}\ =\ millis();}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ }
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}LoRa\ 0x"{}}\ +\ String(sourceMAC,\ HEX)\ +\ \textcolor{stringliteral}{"{}\ is\ not\ time\ source,\ discarding\ request"{}});}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}}\ ==\ 1\ \&\&\ receiveData[0].cmd\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ae8c4c8b96c31a124ba227f864bf69a28}{cmd\_time}}\ \&\&\ receiveData[0].param\ ==\ 0)\ \{\ \textcolor{comment}{//\ Time\ requested}}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Received\ LoRa\ time\ request\ from\ 0x"{}}\ +\ String(sourceMAC,HEX));}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a181e287094b776a5461ee501144b60de}{sendTimeLoRa}}(sourceMAC);}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ data\ we\ have\ received\ is\ not\ yet\ programmed.\ \ How\ we\ handle\ is\ future\ enhancement.}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}Received\ some\ LoRa\ SystemPacket\ data\ that\ is\ not\ yet\ handled.\ \ To\ be\ handled\ in\ future\ enhancement."{}});}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}ln:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}})\ +\ \textcolor{stringliteral}{"{}data\ type:\ "{}}\ +\ String(receiveData[0].cmd));}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ae9f7e5dca7e70b1946e0f125f72f5126}{rxCountCrcOk}}++;}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ae989d9d773a74fcc7a0efce652f99ece}{CRC\_OK}};}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}ACK\ Received\ CRC\ Mismatch!\ Packet\ CRC\ is\ 0x"{}}\ +\ String(packetCRC,\ HEX)\ +\ \textcolor{stringliteral}{"{},\ Calculated\ CRC\ is\ 0x"{}}\ +\ String(calcCRC,\ HEX));}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}})\ \{}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a92bbf2c3ed0a51438e18f5d507fbf2d3}{stCrcMismatch}};}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560a892b1e404d6fbb471d6476088ad0accf}{CRC\_BAD}};}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \{\ \ \ \textcolor{comment}{//\ Uncommenting\ below\ will\ print\ out\ packets\ from\ other\ LoRa\ controllers\ being\ sent.}}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DBG2("{}Incoming\ LoRa\ packet\ of\ "{}\ +\ String(packetSize)\ +\ "{}\ bytes\ received\ from\ address\ 0x"{}\ +\ String(sourceMAC,\ HEX)\ +\ "{}\ destined\ for\ node\ address\ 0x"{}\ +\ String(destMAC,\ HEX));}}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ printLoraPacket(packet,sizeof(packet));}}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ac037419533386993875162c16f43800a}{CRC\_NULL}};}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ \}}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00618\ \ \ \ \ \{}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (packetSize\ !=\ 0)}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}Incoming\ LoRa\ packet\ of\ "{}}\ +\ String(packetSize)\ +\ \textcolor{stringliteral}{"{}\ bytes\ not\ processed."{}});}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ uint8\_t\ packet[packetSize];}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ radio.readData((uint8\_t\ *)\&packet,\ packetSize);}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ printLoraPacket(packet,sizeof(packet));}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ac037419533386993875162c16f43800a}{CRC\_NULL}};}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00627\ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ac037419533386993875162c16f43800a}{CRC\_NULL}};}
\DoxyCodeLine{00629\ \}}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560}{crcResult}}\ \mbox{\hyperlink{fdrs__lora_8h_a094456191931f3c05e93a11d8a6e51f9}{LoRaTxRxOperation}}()\ }
\DoxyCodeLine{00632\ \{}
\DoxyCodeLine{00633\ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560}{crcResult}}\ \mbox{\hyperlink{fdrs__node_8h_af346f9786959d3e7cb99636370094e98}{crcReturned}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a837c0fc43b79ca95e0a7141424043560ac037419533386993875162c16f43800a}{CRC\_NULL}};}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__lora_8h_a53896c79caaa5baeab6a96ab3365dcaf}{operationDone}})}
\DoxyCodeLine{00636\ \ \ \ \ \{\ \textcolor{comment}{//\ the\ interrupt\ was\ triggered}}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DBG("{}Interrupt\ triggered"{});}}
\DoxyCodeLine{00638\ \ \ \ \ \textcolor{comment}{//\ DBG("{}TxFlag:\ "{}\ +\ String(transmitFlag));}}
\DoxyCodeLine{00639\ \ \ \ \ \textcolor{comment}{//\ DBG("{}TxStatus:\ "{}\ +\ String(TxStatus));}}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_af78d7af059e439bcd8015ed07513499b}{enableFDRSInterrupt}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a53896c79caaa5baeab6a96ab3365dcaf}{operationDone}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__lora_8h_a09fc5ccb165c85a893083f66bcf6707e}{transmitFlag}})\ \ \textcolor{comment}{//\ the\ previous\ operation\ was\ transmission}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \{\ \ \ }
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.finishTransmit();}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aad5e08feb2be4947352bc94a98949d0c}{stCompleted}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ airtime:\ "{}}\ +\ String(millis()\ -\/\ \mbox{\hyperlink{fdrs__lora_8h_ad32e5278380d7510ef27e528d32a3672}{tx\_start\_time}})\ +\ \textcolor{stringliteral}{"{}ms"{}});}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.startReceive();\ \textcolor{comment}{//\ return\ to\ listen\ mode}}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ ACK\ timeout\ after\ transmission\ is\ completed.}}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}})\ \{}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a69a087bfc34b62d53dbba9720f0bad87}{loraAckTimeout}}\ =\ millis();}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a09fc5ccb165c85a893083f66bcf6707e}{transmitFlag}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Serial.println("{}TxINT!"{});}}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ the\ previous\ operation\ was\ reception}}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__node_8h_af346f9786959d3e7cb99636370094e98}{crcReturned}}\ =\ \mbox{\hyperlink{fdrs__lora_8h_abcacf76f32a98451684e7a2ed4a353a5}{receiveLoRa}}();}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{fdrs__lora_8h_a09fc5ccb165c85a893083f66bcf6707e}{transmitFlag}})\ \textcolor{comment}{//\ return\ to\ listen\ if\ no\ transmission\ was\ begun}}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ad06a65e54e876d013b735043dbdf5005}{radio}}.startReceive();}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Serial.println("{}RxINT!"{});}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ delay(10);}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_af78d7af059e439bcd8015ed07513499b}{enableFDRSInterrupt}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00667\ \ \ \ \ \}}
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{fdrs__node_8h_af346f9786959d3e7cb99636370094e98}{crcReturned}};}
\DoxyCodeLine{00669\ \}}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \textcolor{comment}{//\ FDRS\ Sensor\ pings\ address\ and\ listens\ for\ a\ defined\ amount\ of\ time\ for\ a\ reply\ if\ no\ tx\ in\ process}}
\DoxyCodeLine{00672\ \textcolor{comment}{//\ otherwise\ queues\ up\ a\ ping\ in\ the\ SP\ Buffer.}}
\DoxyCodeLine{00673\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{fdrs__lora_8h_acb6e120ce92a8851fe1cb471da64409d}{pingRequestLoRa}}(uint16\_t\ address,\ uint32\_t\ timeout)}
\DoxyCodeLine{00674\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{keywordtype}{int}\ pingResult\ =\ -\/1;}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ a\ previous\ ping\ is\ already\ in\ process}}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}})\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ sys\_packet\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7a4da9c09ff21a0893109b13aad2f7ff54}{cmd\_ping}},\ .param\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_aa4dafeab552538320e86e60510104161ad6362076ada2df50c0c1d659420ec819}{ping\_request}}\};}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}}\ =\ timeout;}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_a54545686167b65d4724d6a5169d1befd}{address}}\ =\ address;}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Perform\ blocking\ ping\ if\ nothing\ else\ is\ in\ process}}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}})\ \{}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}};}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}}\ =\ millis();}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ping\ request\ sent\ to\ address:\ 0x"{}}\ +\ String(address,\ HEX));}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(\&address,\&sys\_packet,1);}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}}\ \&\&\ (millis()\ -\/\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}}\ <\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}}))\ \{}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a094456191931f3c05e93a11d8a6e51f9}{LoRaTxRxOperation}}();}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aad5e08feb2be4947352bc94a98949d0c}{stCompleted}})\ \{}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}\ =\ millis()\ -\/\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}};}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pingResult\ =\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}};}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}LoRa\ Ping\ Returned:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}})\ +\ \textcolor{stringliteral}{"{}ms."{}});}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_a54545686167b65d4724d6a5169d1befd}{address}}\ ==\ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}})\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a48b52f719835d08f27b20cad3069d5f5}{netTimeOffset}}\ =\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}/2/1000;}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__time_8h_ab69180d59e85de0e3c4cdedcb5ab74c7}{adjTimeforNetDelay}}(\mbox{\hyperlink{fdrs__lora_8h_a48b52f719835d08f27b20cad3069d5f5}{netTimeOffset}});}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}No\ LoRa\ ping\ returned\ within\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}})\ +\ \textcolor{stringliteral}{"{}ms."{}});}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}}\ =\ 0;}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}}\ =\ 0;}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_a54545686167b65d4724d6a5169d1befd}{address}}\ =\ 0;}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}\ =\ UINT32\_MAX;\ \ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Something\ else\ is\ in\ process,\ Most\ likely\ LoRa\ ACK,\ so\ queue\ up\ the\ ping}}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&address,\ \&sys\_packet,\ 1))}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ping\ request\ queued\ to\ address:\ 0x"{}}\ +\ String(address,\ HEX));}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Error\ sending\ LoRa\ ping."{}});}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00721\ \ \ \ \ \}}
\DoxyCodeLine{00722\ \ \ \ \ \textcolor{keywordflow}{return}\ pingResult;}
\DoxyCodeLine{00723\ \}}
\DoxyCodeLine{00724\ }
\DoxyCodeLine{00725\ \textcolor{comment}{//\ Sends\ packet\ to\ any\ node\ that\ is\ paired\ to\ this\ gateway}}
\DoxyCodeLine{00726\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_adbc61d9a3623cc657286bfc8405a7f1a}{broadcastLoRa}}()}
\DoxyCodeLine{00727\ \{}
\DoxyCodeLine{00728\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Sending\ to\ LoRa\ broadcast\ buffer"{}});}
\DoxyCodeLine{00729\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&loraBroadcast,\mbox{\hyperlink{fdrs__gateway_8h_a718ba593017f95b5e4a74c39d9ad852f}{theData}},\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}});}
\DoxyCodeLine{00730\ \}}
\DoxyCodeLine{00731\ }
\DoxyCodeLine{00732\ \textcolor{comment}{//\ Sends\ packet\ to\ neighbor\ gateways}}
\DoxyCodeLine{00733\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_a1a7268338826ad6bb40a70f615c730a8}{sendLoRaNbr}}(uint8\_t\ interface)}
\DoxyCodeLine{00734\ \{}
\DoxyCodeLine{00735\ \ \ \mbox{\hyperlink{fdrs__debug_8h_adf135b87caf84f55fccdf33f614415ae}{DBG}}(\textcolor{stringliteral}{"{}Sending\ to\ LoRa\ neighbor\ buffer"{}});}
\DoxyCodeLine{00736\ \ \ \textcolor{keywordflow}{switch}\ (interface)}
\DoxyCodeLine{00737\ \ \ \{}
\DoxyCodeLine{00738\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&LoRa1,\mbox{\hyperlink{fdrs__gateway_8h_a718ba593017f95b5e4a74c39d9ad852f}{theData}},\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}});}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00743\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&LoRa2,\mbox{\hyperlink{fdrs__gateway_8h_a718ba593017f95b5e4a74c39d9ad852f}{theData}},\mbox{\hyperlink{fdrs__gateway_8h_aabf3459d6bb55f6124eaba25e6ad6609}{ln}});}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00748\ \ \ \}}
\DoxyCodeLine{00749\ \}}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00751\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{fdrs__lora_8h_afcfa506ffe12e69a13e036bf2c186df8}{handleLoRa}}()}
\DoxyCodeLine{00752\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \textcolor{keyword}{static}\ uint8\_t\ len\ =\ 0;}
\DoxyCodeLine{00754\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}\ *data;}
\DoxyCodeLine{00755\ \ \ \ \ \textcolor{keyword}{static}\ uint16\_t\ address;}
\DoxyCodeLine{00756\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ lastTxtime\ =\ 0;}
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ statsTime\ =\ 0;}
\DoxyCodeLine{00758\ \ \ \ \ }
\DoxyCodeLine{00759\ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a094456191931f3c05e93a11d8a6e51f9}{LoRaTxRxOperation}}();}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ \textcolor{comment}{//\ check\ for\ result\ of\ any\ ongoing\ async\ ping\ operations}}
\DoxyCodeLine{00762\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aad5e08feb2be4947352bc94a98949d0c}{stCompleted}})\ \{}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}\ =\ millis()\ -\/\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}};}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ Ping\ Returned:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}})\ +\ \textcolor{stringliteral}{"{}ms."{}});}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_a54545686167b65d4724d6a5169d1befd}{address}}\ ==\ \mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}})\ \{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a48b52f719835d08f27b20cad3069d5f5}{netTimeOffset}}\ =\ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}/2/1000;}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__time_8h_ab69180d59e85de0e3c4cdedcb5ab74c7}{adjTimeforNetDelay}}(\mbox{\hyperlink{fdrs__lora_8h_a48b52f719835d08f27b20cad3069d5f5}{netTimeOffset}});}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}}\ =\ 0;}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}}\ =\ 0;}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_a54545686167b65d4724d6a5169d1befd}{address}}\ =\ 0;}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}\ =\ UINT32\_MAX;\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00774\ \ \ \ \ \}}
\DoxyCodeLine{00775\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}}\ \&\&\ (\mbox{\hyperlink{fdrs__time_8h_a21663dd18026eef043bcf3e1467bf8ae}{TDIFF}}(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}},\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}})))\ \{}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}No\ LoRa\ ping\ returned\ within\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}})\ +\ \textcolor{stringliteral}{"{}ms."{}});}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}}\ =\ 0;}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad2a0d5d12155cf832a042af3a3f1f2a8}{timeout}}\ =\ 0;}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_a54545686167b65d4724d6a5169d1befd}{address}}\ =\ 0;}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_af575f79e46e4f14717ac186335c9cd5d}{response}}\ =\ UINT32\_MAX;\ \ \ \ }
\DoxyCodeLine{00782\ \ \ \ \ \}\ }
\DoxyCodeLine{00783\ \ \ \ \ }
\DoxyCodeLine{00784\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ retries\ =\ \mbox{\hyperlink{fdrs__lora_8h_af707fbbcd7b84fd0c843c7732e63e8b8}{FDRS\_LORA\_RETRIES}};}
\DoxyCodeLine{00785\ \ \ \ \ }
\DoxyCodeLine{00786\ \ \ \ \ \textcolor{comment}{//\ Process\ any\ DR\ ACKs\ in\ progress}}
\DoxyCodeLine{00787\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}}\ \&\&\ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ !=\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}})\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a13e882d3b2a4c0130d1184048e49cb3f}{stCrcMatch}})}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ACK\ Received!\ CRC\ OK"{}});}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ free(data);}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ NULL;}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ retries\ =\ \mbox{\hyperlink{fdrs__lora_8h_af707fbbcd7b84fd0c843c7732e63e8b8}{FDRS\_LORA\_RETRIES}};}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ 0;}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(retries\ <\ 0)\ \{}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Retries\ Exhausted."{}});}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ retries\ =\ \mbox{\hyperlink{fdrs__lora_8h_af707fbbcd7b84fd0c843c7732e63e8b8}{FDRS\_LORA\_RETRIES}};}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a5574e9ef98c09926b8b80d4ae41f09fd}{ISBUFFFULL}}(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}))\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ 0;}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ free(data);}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ NULL;}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ we\ transmit\ ourselves\ to\ death\ or\ just\ drop\ the\ data?}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ here\ we\ drop\ the\ data\ so\ we\ don't\ keep\ transmitting\ to\ death}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ 0;}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ free(data);}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ NULL;}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a92bbf2c3ed0a51438e18f5d507fbf2d3}{stCrcMismatch}})}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ACK\ Received!\ CRC\ BAD"{}});}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ Resend\ original\ packet\ again\ if\ retries\ are\ available}}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{fdrs__time_8h_a21663dd18026eef043bcf3e1467bf8ae}{TDIFF}}(\mbox{\hyperlink{fdrs__lora_8h_a69a087bfc34b62d53dbba9720f0bad87}{loraAckTimeout}},\mbox{\hyperlink{fdrs__lora_8h_a325e8942ca595ccf0434ac50e49851e8}{FDRS\_ACK\_TIMEOUT}}))\ \{}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ Timeout\ waiting\ for\ ACK!"{}});}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ resend\ original\ packet\ again\ if\ retries\ are\ available}}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aad5e08feb2be4947352bc94a98949d0c}{stCompleted}})\ \{}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00827\ \ \ \ \ \}}
\DoxyCodeLine{00828\ }
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{comment}{//\ Start\ Transmit\ data\ from\ the\ SystemPacket\ queue}}
\DoxyCodeLine{00830\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{fdrs__lora_8h_a19b3ce753b03a0d7ac5bff588aa68924}{ISBUFFEMPTY}}(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}})\ \&\&\ (\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}}))\ \{}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}SP\ Index:\ start:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}})\ +\ \textcolor{stringliteral}{"{}\ end:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_ad81cacbdce05a50f9ee9cb228dce061a}{endIdx}})\ +\ \textcolor{stringliteral}{"{}\ Address:\ 0x"{}}\ +\ String(*(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_abb07d423f8f393794dad992291c7dd1c}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}}),HEX)\ +\ \textcolor{stringliteral}{"{}\ Cmd:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_aed49a3c8d8b07f8fde3420483c5b0a57}{sp}}-\/>cmd));}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lora\ ping\ request\ stuff\ here}}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_aed49a3c8d8b07f8fde3420483c5b0a57}{sp}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}})-\/>cmd\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7a4da9c09ff21a0893109b13aad2f7ff54}{cmd\_ping}}\ \&\&\ (\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_aed49a3c8d8b07f8fde3420483c5b0a57}{sp}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}})-\/>param\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_aa4dafeab552538320e86e60510104161ad6362076ada2df50c0c1d659420ec819}{ping\_request}})\ \{}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_aef433a88da29e173ce7372632fe1e112}{status}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}};}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_accd94183b4e296b919c89fa4240404cb}{loraPing}}.\mbox{\hyperlink{struct_ping_ad77a9b3d75d66c0966c9f5b144533d51}{start}}\ =\ millis();}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ ping\ request\ sent\ to\ address:\ 0x"{}}\ +\ String(*(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_abb07d423f8f393794dad992291c7dd1c}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}}),\ HEX));}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}((\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_abb07d423f8f393794dad992291c7dd1c}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}}),\ (\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_aed49a3c8d8b07f8fde3420483c5b0a57}{sp}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}}.\mbox{\hyperlink{struct_s_p_ring_buffer_a3166ebea232b07e76abbd28a6295c426}{startIdx}}),\ 1);}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_af43d1a73cc05315ae8de6c47d2874786}{BUFFINCSTART}}(\mbox{\hyperlink{fdrs__lora_8h_a9adc4024f41366316f4e3981126c5964}{spBuff}});}
\DoxyCodeLine{00840\ \ \ \ \ \}}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ \ \ \textcolor{comment}{//\ It's\ polite\ to\ Listen\ more\ than\ you\ talk}}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__time_8h_a21663dd18026eef043bcf3e1467bf8ae}{TDIFF}}(lastTxtime,(\mbox{\hyperlink{fdrs__lora_8h_a4e8988ccf8df847db6ee047234d63718}{TXDELAYMS}}\ +\ random(0,50))))\ \{}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ Transmit\ data\ from\ the\ DataReading\ queue}}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((!\mbox{\hyperlink{fdrs__lora_8h_a19b3ce753b03a0d7ac5bff588aa68924}{ISBUFFEMPTY}}(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}})\ ||\ (data\ !=\ NULL))\ \&\&\ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}}\ \&\&\ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}})\ }
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for(int\ i=drBuff.startIdx;\ i!=drBuff.endIdx;\ i\ =\ (i\ +\ 1)\ \%\ drBuff.size)\ \{}}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ printf("{}id:\ \%d,\ type:\ \%d\ data:\ \%f\ address:\ \%X\(\backslash\)n"{},(drBuff.dr\ +\ i)-\/>id,\ (drBuff.dr\ +\ i)-\/>t,\ (drBuff.dr\ +\ i)-\/>d,\ *(spBuff.address\ +\ spBuff.startIdx));}}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ data\ memory\ is\ not\ freed\ when\ retries\ are\ exhausted\ and\ DataReading\ queue\ is\ not\ full}}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(data\ ==\ NULL)\ \{}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ number\ of\ DRs\ going\ to\ same\ destination\ address}}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ \mbox{\hyperlink{fdrs__lora_8h_a966f72b5662abef538f8611d6e50798f}{transmitSameAddrLoRa}}();}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TransmitLoRa\ cannot\ handle\ a\ circular\ buffer\ so\ need\ data\ in\ one\ contiguous\ segment\ of\ memory}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ (\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}\ *)malloc(len\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{fdrs__datatypes_8h_a7b09e766d667a010c474eeb88632d1d5}{DataReading}}));}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transfer\ data\ readings\ from\ the\ ring\ buffer\ to\ our\ local\ buffer}}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *(data\ +\ i)\ =\ *(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a4e75477f21f18498f8f3d8ff55eb43ea}{dr}}\ +\ ((\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}}\ +\ i)\ \%\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5a652051b9bd955cb4861dbd95bd2267}{size}}));}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ address\ =\ *(\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_af385236abc4145b6d4695b41ec98bece}{address}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}});}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ now\ we\ have\ the\ data,\ we\ can\ release\ it\ from\ the\ ring\ buffer}}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}}\ =\ (\mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5f7dfc224b8aa8deaef96169624440bf}{startIdx}}\ +\ len)\ \%\ \mbox{\hyperlink{fdrs__lora_8h_a887ff2e2650aba2f11e13d7849284209}{drBuff}}.\mbox{\hyperlink{struct_d_r_ring_buffer_a5a652051b9bd955cb4861dbd95bd2267}{size}};}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_a3710656646b77d04495c18395a69549a}{DBG2}}(\textcolor{stringliteral}{"{}Length:\ "{}}\ +\ String(len)\ +\ \textcolor{stringliteral}{"{}\ Address:\ 0x"{}}\ +\ String(address,HEX)\ +\ \textcolor{stringliteral}{"{}\ Data:"{}});}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for(int\ i=0;\ i<\ len;\ i++)\ \{}}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ printf("{}id:\ \%d,\ type:\ \%d\ data:\ \%f\(\backslash\)n"{},(data\ +\ i)-\/>id,\ (data\ +\ i)-\/>t,\ (data\ +\ i)-\/>d);}}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{fdrs__lora_8h_aee9399e0ee90a2982d7de00ac826f097}{ack}}\ \&\&\ data\ !=\ NULL)\ }
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(\&address,\ data,\ len);}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ free(data);}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ NULL;}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ 0;}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(data\ !=\ NULL)}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ }
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retries-\/-\/;}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a171826655215796b93f9fdf1be7c12a4}{loraAckState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aa97596956ae290dd99cdc85ab18262d4}{stInProcess}};}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(\&address,\ data,\ len);}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ping\ LoRa\ time\ master\ to\ estimate\ time\ delay\ in\ radio\ link}}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_a94d9f4625ede8aeb5191e8a9463b18bc}{tmNetIf}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_ac11f08c2870e2d2711e6ad57b57b81e0a1b25e81aeb538cf0a393b10ab33435d8}{TMIF\_LORA}})\ \{}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ lastTimeSourcePing\ =\ 0;}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ping\ the\ time\ source\ every\ 10\ minutes}}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__time_8h_adbb44fde32f342c98a304566f0e5c913}{TDIFFMIN}}(lastTimeSourcePing,10)\ ||\ lastTimeSourcePing\ ==\ 0)\ \{}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_acb6e120ce92a8851fe1cb471da64409d}{pingRequestLoRa}}(\mbox{\hyperlink{fdrs__gateway_8h_a527cdff0000383c77ef8828e6210e9c9}{timeSource}}.\mbox{\hyperlink{struct_time_source_aec3ea3d9186e839fa7915c6518cf4ab3}{tmAddress}},4000);}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ lastTimeSourcePing\ =\ millis();}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ lastTxtime\ =\ millis();}
\DoxyCodeLine{00896\ \ \ \ \ \}}
\DoxyCodeLine{00897\ \ \ \ \ \textcolor{comment}{//\ Print\ LoRa\ statistics}}
\DoxyCodeLine{00898\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__time_8h_af2ea72994067f7522f3aadd69899c701}{TDIFFSEC}}(statsTime,65)\ \&\&\ (\mbox{\hyperlink{fdrs__lora_8h_a95837beac679b370b386022cd310d1b7}{rxCountDR}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_abd895bcd719e719cbbe6b8427e7b4eae}{rxCountSP}})\ >\ 0)\ \{}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ statsTime\ =\ millis();}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}LoRa\ Stats\ -\/\ Rx\ DR:"{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a95837beac679b370b386022cd310d1b7}{rxCountDR}})\ +\ \textcolor{stringliteral}{"{}\ SP:"{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_abd895bcd719e719cbbe6b8427e7b4eae}{rxCountSP}})\ +\ \textcolor{stringliteral}{"{}\ Tx\ DR:"{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_af1ff085b3dd4a61d04fd806ad43dbfa9}{txCountDR}})\ +\ \textcolor{stringliteral}{"{}\ SP:"{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_a2d5be132cf96e263372a18dbac40389a}{txCountSP}})\ +\ \textcolor{stringliteral}{"{}\ CRC\ OK:\ "{}}\ +\ String(\mbox{\hyperlink{fdrs__lora_8h_ae9f7e5dca7e70b1946e0f125f72f5126}{rxCountCrcOk}}/(\mbox{\hyperlink{fdrs__lora_8h_a95837beac679b370b386022cd310d1b7}{rxCountDR}}\ +\ \mbox{\hyperlink{fdrs__lora_8h_abd895bcd719e719cbbe6b8427e7b4eae}{rxCountSP}})\ *\ 100)\ +\ \textcolor{stringliteral}{"{}\%"{}});}
\DoxyCodeLine{00901\ \ \ \ \ \}}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00903\ \ \ \ \ \textcolor{comment}{//\ Change\ to\ ready\ at\ the\ end\ so\ only\ one\ transmit\ happens\ per\ function\ call}}
\DoxyCodeLine{00904\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15aad5e08feb2be4947352bc94a98949d0c}{stCompleted}})\ \{}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}};}
\DoxyCodeLine{00906\ \ \ \ \ \}}
\DoxyCodeLine{00907\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00908\ \}}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00910\ \textcolor{comment}{//\ Only\ for\ use\ in\ nodes\ -\/\ not\ intended\ to\ be\ used\ in\ gateway}}
\DoxyCodeLine{00911\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{fdrs__lora_8h_a1dbf8358f6b651f668b09459d6a43cd8}{reqTimeLoRa}}()\ \{}
\DoxyCodeLine{00912\ \ \ \ \ \mbox{\hyperlink{fdrs__datatypes_8h_a4e94df1a3d0c53bbaf8d6fb6e8eb4898}{SystemPacket}}\ sys\_packet\ =\ \{.cmd\ =\ \mbox{\hyperlink{fdrs__datatypes_8h_a00d51b3cb2e1fa09bdba2968e0cf7ac7ae8c4c8b96c31a124ba227f864bf69a28}{cmd\_time}},\ .param\ =\ 0\};}
\DoxyCodeLine{00913\ }
\DoxyCodeLine{00914\ \ \ \ \ \mbox{\hyperlink{fdrs__debug_8h_ab6996efcae0768c394bb02b0d2951ffb}{DBG1}}(\textcolor{stringliteral}{"{}Requesting\ time\ from\ gateway\ 0x"{}}\ +\ String(gtwyAddress,HEX));}
\DoxyCodeLine{00915\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_ac51d637ae9396d144760d4e3e09143c2}{loraTxState}}\ ==\ \mbox{\hyperlink{fdrs__datatypes_8h_a7278d16487e30af3bfe098dab93e3a15a115a67279b5c113df80f6b7e6b42a90c}{stReady}})\ \{}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{fdrs__lora_8h_a9ceffe7af0f9922bf5c7003ee8fe0972}{transmitLoRa}}(\&gtwyAddress,\&sys\_packet,1);}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00918\ \ \ \ \ \}}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{fdrs__lora_8h_a6c7409e91d4bbc41a6fba6852be9ed42}{transmitLoRaAsync}}(\&gtwyAddress,\ \&sys\_packet,\ 1))}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00924\ \ \ \ \ \}}
\DoxyCodeLine{00925\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00926\ \}}

\end{DoxyCode}
